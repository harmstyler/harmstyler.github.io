<!DOCTYPE html>
<html lang="en-us">

<head>
    <link href="https://gmpg.org/xfn/11" rel="profile"><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.55.1" /><title>Abstract Time Stamped Entity in Symfony2 • Tyler Harms</title><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Abstract Time Stamped Entity in Symfony2"/>
<meta name="twitter:description" content="One of my favorite features of Ruby on Rails is that all models are timestamped by default. Ruby on Rails, of course, opts for convention over configuration. Symfony2, on the other hand, opts for configuration over convention. Anyone who has worked with Symfony2 can speak to the mass of config files that exist in a project. I can understand, therefore, why timestamped models (entities) are not a feature in Symfony2. In this post I will show how to add timestamp all your Symfony2 entities. For this post, I chose to use Doctrine as my ORM, so all code show directly relates to Doctrine and Symfony2."/>
<meta property="og:title" content="Abstract Time Stamped Entity in Symfony2" />
<meta property="og:description" content="One of my favorite features of Ruby on Rails is that all models are timestamped by default. Ruby on Rails, of course, opts for convention over configuration. Symfony2, on the other hand, opts for configuration over convention. Anyone who has worked with Symfony2 can speak to the mass of config files that exist in a project. I can understand, therefore, why timestamped models (entities) are not a feature in Symfony2. In this post I will show how to add timestamp all your Symfony2 entities. For this post, I chose to use Doctrine as my ORM, so all code show directly relates to Doctrine and Symfony2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://harmstyler.me/posts/2014/abstract-time-stamped-entity-in-symfony2/" />
<meta property="article:published_time" content="2014-02-07T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2014-02-07T00:00:00&#43;00:00"/>
<meta name="copyright" content="Tyler Harms" /><meta name="author" content="Tyler Harms" />


<link rel="stylesheet" href="https://harmstyler.me/css/syntax.min.975cba22ca4dc1f6f8df261fa5f37d5f24b6afa51aaec0cb564f81b3b71a0d6a2dc3a3bf11dc5d540503cb415df0c79167218bec092cb02397817b4690f53444.css" integrity="sha512-l1y6IspNwfb43yYfpfN9XyS2r6UarsDLVk&#43;Bs7caDWotw6O/EdxdVAUDy0Fd8MeRZyGL7AkssCOXgXtGkPU0RA==">





<link rel="stylesheet" href="/scss/hyde-hyde.208fdd69dd25b05080ddfcdf1a9684be856c83a0a5c13edfc3fb170e19465437.css" integrity="sha256-II/dad0lsFCA3fzfGpaEvoVsg6ClwT7fw/sXDhlGVDc=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#6a9fb5"></head>
<body class="theme-base-0d ">
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://harmstyler.me/">Tyler Harms</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://harmstyler.me//img/tyler_portrait.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         A Software Development Blog 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Tyler Harms</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Portfolio</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/harmstyler" rel="me noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/harmstyler" rel="me noopener"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://gitlab.com/harmstyler" rel="me noopener"><i class="fab fa-gitlab fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://instagram.com/harmstyler" rel="me noopener"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/harmstyler" rel="me noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/743245/harmstyler" rel="me noopener"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://keybase.io/harmstyler" rel="me noopener"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 Tyler Harms
  
</div>



  </div>
</div>
<div class="content container">
    <article>
  <header>
    <h1>Abstract Time Stamped Entity in Symfony2</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 7, 2014
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/php">PHP</a>
              •
          
              <a class="badge badge-category" href="/categories/symfony2">SYMFONY2</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/doctrine">doctrine</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  <div class="post">
    <p>One of my favorite features of Ruby on Rails is that all models are timestamped by default. Ruby on Rails, of course, opts for convention over configuration. Symfony2, on the other hand, opts for configuration over convention. Anyone who has worked with Symfony2 can speak to the mass of config files that exist in a project. I can understand, therefore, why timestamped models (entities) are not a feature in Symfony2. In this post I will show how to add timestamp all your Symfony2 entities. For this post, I chose to use Doctrine as my ORM, so all code show directly relates to Doctrine and Symfony2.</p>

<p>Luckily, adding and updated and created fields to an entity in Symfony2 with Doctrine is quite easy:</p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**
</span><span class="sd"> * @var \DateTime
</span><span class="sd"> *
</span><span class="sd"> * @ORM\Column(name=&#34;created&#34;, type=&#34;datetime&#34;)
</span><span class="sd"> */</span>
<span class="k">private</span> <span class="nv">$created</span><span class="p">;</span>

<span class="sd">/**
</span><span class="sd"> * @var \DateTime
</span><span class="sd"> *
</span><span class="sd"> * @ORM\Column(name=&#34;updated&#34;, type=&#34;datetime&#34;)
</span><span class="sd"> */</span>
<span class="k">private</span> <span class="nv">$updated</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setUpdated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// getters &amp; setters
</span><span class="c1"></span>
<span class="sd">/**
</span><span class="sd"> * Auto set the updated date
</span><span class="sd"> *
</span><span class="sd"> * @ORM\PreUpdate
</span><span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">setUpdatedValue</span><span class="p">()</span>
<span class="p">{</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setUpdated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>The code should be pretty self explanitory, we have two DateTime field types that get initially set on entity creation in the contstructor. I then add a <code>setUpdatedValue()</code> function that runs when on PreUpdate of the entity.</p>

<p>The above code works very well, but it is not an ideal solution for working with multiple models. Of course, we could add the updated/created values to every entity, but that wouldn&rsquo;t be very <a href="http://en.wikipedia.org/wiki/Don" title="t_repeat_yourself &quot;Don't Repeat Yourself">DRY</a> of us.</p>

<p>The solution is to use an <a href="http://www.php.net/manual/en/language.oop5.abstract.php">Abstract Class</a> that our entity can extend. The abstract class, <code>TimeStampedEntity</code>, will have two entity variables <code>$updated</code> and <code>$created</code> and will look nearly identical to the code above when it is complete. The key that will make this work with Doctrine and Symfony2 is Doctrine&rsquo;s <a href="http://docs.doctrine-project.org/en/latest/reference/inheritance-mapping.html#mapped-superclasses"><code>MappedSuperclass</code></a> declaration that tells Symfony and Doctrine that the abstract class is a Superclass with declared entity attributes. What we are left with is a Superclass that can extend any model to add <code>updated</code> and <code>created</code> attributes to your data.</p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">HarmsTyler\Common\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**
</span><span class="sd"> * @ORM\MappedSuperclass
</span><span class="sd"> * @ORM\HasLifecycleCallbacks
</span><span class="sd"> */</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">TimeStampedEntity</span> <span class="p">{</span>

    <span class="sd">/**
</span><span class="sd">     * @var \DateTime
</span><span class="sd">     *
</span><span class="sd">     * @ORM\Column(name=&#34;created&#34;, type=&#34;datetime&#34;)
</span><span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$created</span><span class="p">;</span>

    <span class="sd">/**
</span><span class="sd">     * @var \DateTime
</span><span class="sd">     *
</span><span class="sd">     * @ORM\Column(name=&#34;updated&#34;, type=&#34;datetime&#34;)
</span><span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$updated</span><span class="p">;</span>

    <span class="sd">/**
</span><span class="sd">     * Set created
</span><span class="sd">     *
</span><span class="sd">     * @param \DateTime $created
</span><span class="sd">     * @return self
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCreated</span><span class="p">(</span><span class="nv">$created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">created</span> <span class="o">=</span> <span class="nv">$created</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Get created
</span><span class="sd">     *
</span><span class="sd">     * @return \DateTime
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCreated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">created</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Set updated
</span><span class="sd">     *
</span><span class="sd">     * @param \DateTime $updated
</span><span class="sd">     * @return self
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUpdated</span><span class="p">(</span><span class="nv">$updated</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updated</span> <span class="o">=</span> <span class="nv">$updated</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Get updated
</span><span class="sd">     *
</span><span class="sd">     * @return \DateTime
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUpdated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updated</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Auto set the updated date
</span><span class="sd">     *
</span><span class="sd">     * @ORM\PreUpdate
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUpdatedValue</span><span class="p">()</span>
    <span class="p">{</span>
       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setUpdated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Set initial value for created/updated values
</span><span class="sd">     *
</span><span class="sd">     * @ORM\PrePersist
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCreatedValues</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setUpdated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>An example in use:</p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Blend\Iterate\BlogBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">HarmsTyler\Common\Entity\TimeStampedEntity</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**
</span><span class="sd"> * Post
</span><span class="sd"> *
</span><span class="sd"> * @ORM\Table()
</span><span class="sd"> * @ORM\Entity
</span><span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">TimeStampedEntity</span>
<span class="p">{</span>
</code></pre></div>
<p><em>edited to add setCreatedValues()</em></p>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/2013/administrating-solr-a-review/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Administrating Solr: A Review</span>
    </a>
    
    
    <a href="/posts/2014/mixing-angular-and-symfony/" class="navigation-next">
      <span class="navigation-tittle">Mixing AngularJS and Symfony</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  




  
    
        <div id="graphcomment"></div>
<script type="text/javascript">
  window.graphcomment_id = 'harmstyler-me';
   
  (function() {
    var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
    gc.src = 'https://graphcomment.com/js/integration.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
  })();
</script>
    


</article>

</div>
    
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-133041000-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>



    


</body>
</html>
